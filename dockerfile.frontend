FROM denoland/deno:latest

WORKDIR /app

# Copy dependency files first for better caching
COPY deno.json .
COPY .config/ ./.config/

# Cache dependencies
RUN deno install

# Copy frontend source and shared code
COPY frontend/ ./frontend/
COPY shared/ ./shared/

# Set environment variables
ENV NODE_ENV=production
ENV FRONTEND_PORT=5173
ENV BACKEND_PORT=8000

# Expose frontend port
EXPOSE 5173

# Start the frontend (Vite preview server)
CMD ["deno", "task", "dev:ui"]